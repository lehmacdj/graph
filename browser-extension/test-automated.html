<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Extension Automated Tests</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            padding: 20px; 
            line-height: 1.6; 
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .test-controls {
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .run-tests-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 16px;
            border-radius: 25px;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .run-tests-btn:hover {
            transform: translateY(-2px);
        }
        
        .test-results {
            margin: 20px 0;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            font-family: 'Courier New', monospace;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .test-section { 
            margin: 20px 0; 
            padding: 20px; 
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .image-container { 
            display: flex; 
            gap: 20px; 
            flex-wrap: wrap; 
            align-items: center; 
            justify-content: center;
        }
        
        img { 
            max-width: 200px; 
            height: auto; 
            border-radius: 8px;
            transition: transform 0.3s;
        }
        
        img:hover {
            transform: scale(1.05);
        }
        
        svg { 
            border: 2px solid #333; 
            overflow: hidden;
            border-radius: 8px;
        }
        
        .section-title {
            color: #333;
            border-bottom: 2px solid #667eea;
            padding-bottom: 5px;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üß™ Image Extension Automated Test Suite</h1>
        <p>This page tests the Image Extension functionality with automated mouse simulation</p>
    </div>
    
    <div class="test-controls">
        <button class="run-tests-btn" onclick="runAllTests()">‚ñ∂Ô∏è Run All Tests</button>
        <div id="test-status" style="margin-top: 10px; font-weight: bold;"></div>
    </div>
    
    <div id="test-results" class="test-results" style="display: none;">
        <h3>üìä Test Results:</h3>
        <div id="test-output"></div>
    </div>
    
    <div class="test-section">
        <h2 class="section-title">üñºÔ∏è Single Images (for basic hover tests)</h2>
        <div class="image-container">
            <img id="test-img-1" src="https://via.placeholder.com/200x150/FF6B6B/ffffff?text=Test+Image+1" alt="Test Image 1">
            <img id="test-img-2" src="https://via.placeholder.com/150x200/4ECDC4/ffffff?text=Test+Image+2" alt="Test Image 2">
            <img id="test-img-3" src="https://via.placeholder.com/180x120/45B7D1/ffffff?text=Test+Image+3" alt="Test Image 3">
        </div>
    </div>

    <div class="test-section">
        <h2 class="section-title">üéØ Multi-Image Container (for container tests)</h2>
        <div id="multi-image-container" class="image-container">
            <img src="https://via.placeholder.com/120x120/DDA0DD/ffffff?text=Multi+1" alt="Multi Image 1">
            <img src="https://via.placeholder.com/120x120/FD79A8/ffffff?text=Multi+2" alt="Multi Image 2">
            <img src="https://via.placeholder.com/120x120/A0E7E5/333333?text=Multi+3" alt="Multi Image 3">
        </div>
    </div>

    <div class="test-section">
        <h2 class="section-title">üé® SVG Images (for SVG detection tests)</h2>
        <div class="image-container">
            <svg width="150" height="100">
                <image id="test-svg-image" href="https://via.placeholder.com/200x150/96CEB4/ffffff?text=SVG+Test" 
                       x="0" y="0" width="200" height="150"/>
            </svg>
            
            <svg id="clipped-svg" width="100" height="150">
                <defs>
                    <clipPath id="clip-test">
                        <circle cx="50" cy="75" r="40"/>
                    </clipPath>
                </defs>
                <image href="https://via.placeholder.com/200x200/FFEAA7/333333?text=Clipped+SVG" 
                       x="0" y="0" width="200" height="200" clip-path="url(#clip-test)"/>
            </svg>
        </div>
    </div>

    <div class="test-section">
        <h2 class="section-title">üîÑ Mixed Content (for complex scenarios)</h2>
        <div class="image-container">
            <p>Mixed container with images and SVG:</p>
            <img src="https://via.placeholder.com/120x120/E17055/ffffff?text=Mixed+IMG" alt="Mixed Image">
            <svg width="120" height="120">
                <image href="https://via.placeholder.com/150x150/74b9ff/ffffff?text=Mixed+SVG" 
                       x="0" y="0" width="150" height="150"/>
            </svg>
        </div>
    </div>

    <!-- Load extension scripts in order -->
    <script src="utils/geometry.js"></script>
    <script src="utils/dom-utils.js"></script>
    <script src="core/image-detection.js"></script>
    <script src="ui/clipboard.js"></script>
    <script src="ui/menu.js"></script>
    <script src="core/event-handlers.js"></script>
    <script src="content.js"></script>
    
    <!-- Load test framework -->
    <script src="tests/test-framework.js"></script>
    <script src="tests/extension-tests.js"></script>
    
    <!-- Load styles -->
    <link rel="stylesheet" href="styles.css">

    <script>
        let testRunning = false;
        
        async function runAllTests() {
            if (testRunning) return;
            
            testRunning = true;
            const button = document.querySelector('.run-tests-btn');
            const status = document.getElementById('test-status');
            const resultsDiv = document.getElementById('test-results');
            const output = document.getElementById('test-output');
            
            button.disabled = true;
            button.textContent = 'üîÑ Running Tests...';
            status.textContent = 'Tests in progress...';
            status.style.color = '#orange';
            
            // Clear previous results
            output.innerHTML = '';
            resultsDiv.style.display = 'block';
            
            // Capture console output for test results
            const originalLog = console.log;
            const originalError = console.error;
            
            console.log = function(...args) {
                output.innerHTML += '<div style="color: #333;">' + args.join(' ') + '</div>';
                originalLog.apply(console, args);
            };
            
            console.error = function(...args) {
                output.innerHTML += '<div style="color: #e74c3c;">' + args.join(' ') + '</div>';
                originalError.apply(console, args);
            };
            
            try {
                // Wait for extension to be fully loaded
                await new Promise(resolve => setTimeout(resolve, 500));
                
                // Run all tests
                await window.TestFramework.runAll();
                
                // Show summary
                const results = window.TestFramework.results;
                const passed = results.filter(r => r.status === 'PASS').length;
                const failed = results.filter(r => r.status === 'FAIL').length;
                
                if (failed === 0) {
                    status.textContent = `‚úÖ All ${passed} tests passed!`;
                    status.style.color = '#27ae60';
                } else {
                    status.textContent = `‚ùå ${failed} tests failed, ${passed} passed`;
                    status.style.color = '#e74c3c';
                }
                
            } catch (error) {
                status.textContent = 'üí• Test suite crashed: ' + error.message;
                status.style.color = '#e74c3c';
                console.error('Test suite error:', error);
            } finally {
                // Restore console
                console.log = originalLog;
                console.error = originalError;
                
                button.disabled = false;
                button.textContent = '‚ñ∂Ô∏è Run All Tests';
                testRunning = false;
            }
        }
        
        // Auto-scroll test results
        const testOutput = document.getElementById('test-output');
        const observer = new MutationObserver(() => {
            testOutput.scrollTop = testOutput.scrollHeight;
        });
        observer.observe(testOutput, { childList: true });
        
        // Show ready status
        window.addEventListener('load', () => {
            setTimeout(() => {
                const status = document.getElementById('test-status');
                status.textContent = '‚ú® Ready to run tests!';
                status.style.color = '#667eea';
            }, 1000);
        });
    </script>
</body>
</html>